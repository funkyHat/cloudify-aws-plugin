tosca_definitions_version: cloudify_dsl_1_3

description: >
  Do things with S3, cause happiness.

imports:
  - http://www.getcloudify.org/spec/cloudify/3.4/types.yaml
  - plugin.yaml

inputs:
  docker_image_name:
    description: >
      Name of image which will be retrieved from docker hub.
    default: hello-world

  aws_access_key_id:
    description: >
      The access key ID used to access the AWS API
  aws_secret_access_key:
    description: >
      The secret key used to access the AWS API

node_templates:

  cluster1:
    type: cloudify.aws.nodes.ECSCluster
    properties:
      name: sw-test
      aws_config:
        aws_access_key_id: { get_input: aws_access_key_id }
        aws_secret_access_key: { get_input: aws_secret_access_key }

  service1:
    type: cloudify.aws.nodes.ECSService
    properties:
      name: sw-test
      desired_count: 1
      aws_config:
        aws_access_key_id: { get_input: aws_access_key_id }
        aws_secret_access_key: { get_input: aws_secret_access_key }
    relationships:
      - type: cloudify.aws.relationships.ecs_service_running_on_cluster
        target: cluster1
      - type: cloudify.aws.relationships.ecs_service_runs_task
        target: task1

  con1:
    type: cloudify.aws.nodes.ECSContainer
    properties:
      name: 'hello'
      memory: 4
      image: { get_input: docker_image_name }

  vol1:
    type: cloudify.aws.nodes.ECSVolume
    properties:
      name: 'vol1'

  task1:
    type: cloudify.aws.nodes.ECSTask
    properties:
      name: 'test'
      aws_config:
        aws_access_key_id: { get_input: aws_access_key_id }
        aws_secret_access_key: { get_input: aws_secret_access_key }
    relationships:
      - type: cloudify.aws.relationships.ecs_container_for_task
        target: con1
      - type: cloudify.aws.relationships.ecs_volume_for_task
        target: vol1
